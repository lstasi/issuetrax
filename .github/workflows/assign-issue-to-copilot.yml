# Workflow to automatically assign new issues to the Copilot agent
# This ensures all newly created issues are assigned to Copilot for tracking and management
name: Assign Issue to Copilot

on:
  issues:
    types: [opened]

permissions:
  issues: write
  contents: read

jobs:
  assign-to-copilot:
    runs-on: ubuntu-latest
    steps:
      - name: Assign issue to Copilot agent
        uses: actions/github-script@v8
        with:
          script: |
            try {
              // Get the issue to check current assignees
              const issue = await github.rest.issues.get({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number
              });
              
              // Check if copilot is already assigned
              const assignees = issue.data.assignees.map(a => a.login);
              if (assignees.includes('copilot')) {
                console.log(`Issue #${context.issue.number} is already assigned to @copilot`);
                return;
              }
              
              // Assign to copilot
              await github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                assignees: ['copilot']
              });
              console.log(`Successfully assigned issue #${context.issue.number} to @copilot`);
            } catch (error) {
              console.error(`Failed to assign issue: ${error.message}`);
              // Don't fail the workflow if assignment fails (e.g., if copilot user doesn't exist)
            }
