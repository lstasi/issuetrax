# Workflow to automatically assign new issues to the Copilot agent
# This ensures all newly created issues are assigned to Copilot for tracking and management
name: Assign Issue to Copilot

on:
  issues:
    types: [opened]

permissions:
  issues: write
  contents: read

jobs:
  assign-to-copilot:
    runs-on: ubuntu-latest
    env:
      # GitHub username to assign issues to
      ASSIGNEE: copilot
    steps:
      - name: Assign issue to Copilot agent
        uses: actions/github-script@v8
        with:
          script: |
            try {
              const assignee = process.env.ASSIGNEE;
              
              // Get the issue to check current assignees
              const issue = await github.rest.issues.get({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number
              });
              
              // Check if assignee is already assigned
              const assignees = issue.data.assignees.map(a => a.login);
              if (assignees.includes(assignee)) {
                console.log(`Issue #${context.issue.number} is already assigned to @${assignee}`);
                return;
              }
              
              // Assign to the specified user
              await github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                assignees: [assignee]
              });
              console.log(`Successfully assigned issue #${context.issue.number} to @${assignee}`);
            } catch (error) {
              console.error(`Failed to assign issue: ${error.message}`);
              // Don't fail the workflow if assignment fails (e.g., if assignee user doesn't exist)
            }
